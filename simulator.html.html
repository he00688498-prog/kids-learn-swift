<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>2 台螢幕模擬器（單位可選+加速度顯示）</title>
<style>
  :root{--bg:#0f172a;--ink:#e5e7eb;--muted:#94a3b8;--card:#0b1224;--panel:#111827;--accent:#60a5fa;--ring:rgba(96,165,250,.35)}
  *{box-sizing:border-box}
  body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans TC",sans-serif;color:var(--ink);background:#0b1020}
  h1{margin:18px 0 10px;font-size:clamp(22px,4vw,32px)}
  .wrap{max-width:1200px;margin:0 auto;padding:18px}
  .controls{display:grid;gap:10px;grid-template-columns:repeat(auto-fit,minmax(230px,1fr));background:#0e1729;border:1px solid #1f2937;border-radius:14px;padding:14px}
  .control{display:flex;flex-direction:column;gap:6px}
  .control label{font-size:13px;color:#cbd5e1}
  .control input,.control select{padding:10px 12px;border:1px solid #334155;border-radius:10px;background:#0b1224;color:#e5e7eb}
  .btn{padding:10px 14px;border-radius:10px;border:1px solid #334155;background:linear-gradient(135deg,#60a5fa,#22d3ee);color:#061422;font-weight:700;cursor:pointer}
  .hint{font-size:12px;color:#93a1b5}
  .stage{margin-top:14px;background:#0b1224;border:1px solid #1f2937;border-radius:14px;padding:10px}
  #container{position:relative;width:min(96vw,1120px);margin:0 auto;border:2px solid #334155;border-radius:10px;overflow:hidden;background:#0b1224}
  .ground{position:absolute;left:0;right:0;bottom:0;height:2px;background:#9ca3af}
  .wall{position:absolute;inset:0;border-top:2px solid #334155;border-bottom:2px solid #334155}
  .tick{position:absolute;bottom:0;width:1px;background:#94a3b8;height:10px;opacity:.9}
  .ticklabel{position:absolute;bottom:12px;transform:translateX(-50%);font-size:11px;color:#cbd5e1}
  .screen{position:absolute;background:#60a5fa;border:2px solid #1d4ed8;border-radius:6px;color:#041226;font-size:12px;display:flex;align-items:center;justify-content:center;font-weight:700;box-shadow:0 6px 20px rgba(34,211,238,.25)}
  .person{position:absolute;display:flex;flex-direction:column;align-items:center;justify-content:flex-end;pointer-events:none}
  .head{background:#94a3b8;border-radius:999px}
  .body{background:#94a3b8;border-radius:6px}
  .legend{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;font-size:12px;color:#cbd5e1;margin-top:8px}
  .chip{display:inline-flex;gap:6px;align-items:center;background:#0e1729;border:1px solid #1f2937;padding:6px 10px;border-radius:999px}
  .dot{width:10px;height:10px;border-radius:999px}
  /* 表格樣式 */
  table{width:100%;border-collapse:collapse;margin-top:18px}
  th,td{border:1px solid #334155;padding:6px 8px;font-size:13px;text-align:center}
  th{background:#0e1729;color:#cbd5e1}
  td input{width:90%;padding:4px;background:#0b1224;color:#e5e7eb;border:1px solid #334155;border-radius:6px;text-align:center}
</style>
</head>
<body>
<div class="wrap">
  <h1>2 台螢幕模擬器（單位可選+加速度顯示）</h1>

  <!-- 控制面板 -->
  <div class="controls">
    <div class="control">
      <label>動畫時間（秒）</label>
      <input id="duration" type="number" value="8" />
    </div>
    <div class="control">
      <label>速度單位</label>
      <select id="unit">
        <option value="cm">cm/s</option>
        <option value="m">m/s</option>
      </select>
    </div>
    <div class="control">
      <label>碰壁反彈</label>
      <select id="bounce">
        <option value="off">關閉</option>
        <option value="on">開啟</option>
      </select>
    </div>
    <div class="control">
      <label>人物身高（cm）</label>
      <input id="personH" type="number" value="170" />
    </div>
    <div class="control" style="grid-column:1/-1">
      <button class="btn" id="run">開始動畫</button>
      <div class="hint">在下方表格設定兩台螢幕的起始位置、邊界、初速與終速，將自動顯示加速度。</div>
    </div>
  </div>

  <!-- 模擬畫面 -->
  <div class="stage">
    <div id="container">
      <div class="wall"></div>
      <div class="ground"></div>
    </div>
    <div id="legend" class="legend"></div>
  </div>

  <!-- 2 台螢幕設定表格 -->
  <table>
    <thead>
      <tr>
        <th>螢幕</th>
        <th>起始位置 (m)</th>
        <th>左邊界 (m)</th>
        <th>右邊界 (m)</th>
        <th>初速</th>
        <th>終速</th>
        <th>加速度</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>A</td>
        <td><input id="posA" type="number" value="2"></td>
        <td><input id="leftA" type="number" value="1"></td>
        <td><input id="rightA" type="number" value="5"></td>
        <td><input id="v0A" type="number" value="1"></td>
        <td><input id="v1A" type="number" value="2"></td>
        <td id="aA">-</td>
      </tr>
      <tr>
        <td>B</td>
        <td><input id="posB" type="number" value="10"></td>
        <td><input id="leftB" type="number" value="8"></td>
        <td><input id="rightB" type="number" value="14"></td>
        <td><input id="v0B" type="number" value="1"></td>
        <td><input id="v1B" type="number" value="1.5"></td>
        <td id="aB">-</td>
      </tr>
    </tbody>
  </table>

<script>
const WALL_LEN_M=18, WALL_LEN_CM=WALL_LEN_M*100, WALL_H_CM=400, SCREEN_SIZE_CM=50;
const COLORS=["#60a5fa","#f87171"];
const container=document.getElementById('container');

function pxPerCm(){return container.clientWidth/WALL_LEN_CM}
function layoutHeight(rows=1){
  const scale=pxPerCm();
  const wallHpx=WALL_H_CM*scale;
  const sPx=SCREEN_SIZE_CM*scale;
  const rowGap=Math.max(12,0.3*sPx);
  const stackH=rows*sPx+(rows+1)*rowGap;
  const minH=Math.max(wallHpx,stackH)+24;
  container.style.height=Math.ceil(minH)+'px';
}
function drawRuler(){
  container.querySelectorAll('.tick,.ticklabel').forEach(n=>n.remove());
  const scale=pxPerCm();
  for(let m=1;m<=WALL_LEN_M;m++){
    const x=m*100*scale;
    const t=document.createElement('div');
    t.className='tick'; t.style.left=x+'px';
    container.appendChild(t);
    const lab=document.createElement('div');
    lab.className='ticklabel'; lab.style.left=x+'px';
    lab.textContent=m+' m';
    container.appendChild(lab);
  }
}
function buildPerson(h_cm){
  const scale=pxPerCm();
  const wrap=document.createElement('div'); wrap.className='person';
  const heightPx=h_cm*scale;
  const headDiaCm=Math.min(25,Math.max(12,h_cm*0.13));
  const headPx=headDiaCm*scale;
  const bodyHpx=Math.max(0,heightPx-headPx);
  const bodyWpx=Math.max(2,Math.min(40*scale,heightPx*0.28));
  const head=document.createElement('div'); head.className='head';
  head.style.width=headPx+'px'; head.style.height=headPx+'px';
  const body=document.createElement('div'); body.className='body';
  body.style.width=bodyWpx+'px'; body.style.height=bodyHpx+'px';
  wrap.appendChild(body); wrap.appendChild(head);
  wrap.style.width=Math.max(bodyWpx,headPx)+'px';
  wrap.style.height=heightPx+'px'; wrap.style.position='absolute';
  return{wrap,widthPx:Math.max(bodyWpx,headPx),heightPx:heightPx};
}
function buildScreen(color,label){
  const scale=pxPerCm();
  const el=document.createElement('div'); el.className='screen';
  el.style.width=(SCREEN_SIZE_CM*scale)+'px'; el.style.height=(SCREEN_SIZE_CM*scale)+'px';
  el.style.backgroundColor=color; el.style.borderColor=color; el.textContent=label||'';
  container.appendChild(el);
  return{el};
}

let animId,bodies=[],tAcc=0,tLast=null,bounceOn=false;

function start(){
  cancelAnimationFrame(animId);
  container.querySelectorAll('.person,.screen').forEach(n=>n.remove());

  const duration=parseFloat(document.getElementById('duration').value)||8;
  const personH=Math.max(10,parseFloat(document.getElementById('personH').value)||170);
  bounceOn=document.getElementById('bounce').value==='on';

  const unit=document.getElementById('unit').value;
  const unitK=(unit==='m')?100:1;

  layoutHeight(2);
  drawRuler();
  const p=buildPerson(personH);
  container.appendChild(p.wrap);
  p.wrap.style.left=(container.clientWidth-p.widthPx)/2+'px';
  p.wrap.style.bottom='0px';

  const screensConfig=[
    {
      pos:parseFloat(document.getElementById('posA').value)||1,
      left:parseFloat(document.getElementById('leftA').value)||1,
      right:parseFloat(document.getElementById('rightA').value)||5,
      v0:parseFloat(document.getElementById('v0A').value)||0,
      v1:parseFloat(document.getElementById('v1A').value)||0,
      color:COLORS[0],
      aId:'aA'
    },
    {
      pos:parseFloat(document.getElementById('posB').value)||1,
      left:parseFloat(document.getElementById('leftB').value)||1,
      right:parseFloat(document.getElementById('rightB').value)||5,
      v0:parseFloat(document.getElementById('v0B').value)||0,
      v1:parseFloat(document.getElementById('v1B').value)||0,
      color:COLORS[1],
      aId:'aB'
    }
  ];

  bodies=[];
  screensConfig.forEach((cfg,i)=>{
    const {el}=buildScreen(cfg.color,`螢幕${i===0?'A':'B'}`);
    const scale=pxPerCm();
    const sPx=SCREEN_SIZE_CM*scale;
    const ypx=container.clientHeight-sPx-(i*60)-10;
    el.style.top=ypx+'px';
    // 計算加速度
    const a=(cfg.v1-cfg.v0)/duration;
    // 顯示加速度
    document.getElementById(cfg.aId).textContent=a.toFixed(2);
    bodies.push({
      el,
      x_cm:cfg.pos*100,
      v_cms:cfg.v0*unitK,
      a_cms2:a*unitK,
      left_cm:cfg.left*100,
      right_cm:cfg.right*100-SCREEN_SIZE_CM,
      color:cfg.color
    });
  });

  tAcc=0;tLast=null;const E=1.0;
  function step(ts){
    if(tLast==null)tLast=ts;
    let dt=(ts-tLast)/1000;
    if(dt>0.05)dt=0.05;tLast=ts;tAcc+=dt;
    const scale=pxPerCm();
    bodies.forEach(b=>{
      b.v_cms+=b.a_cms2*dt;
      b.x_cm+=b.v_cms*dt;
      if(bounceOn){
        if(b.x_cm<b.left_cm){b.x_cm=b.left_cm;if(b.v_cms<0)b.v_cms=-b.v_cms*E;}
        if(b.x_cm>b.right_cm){b.x_cm=b.right_cm;if(b.v_cms>0)b.v_cms=-b.v_cms*E;}
      }else{
        if(b.x_cm<b.left_cm)b.x_cm=b.left_cm;
        if(b.x_cm>b.right_cm)b.x_cm=b.right_cm;
      }
      b.el.style.left=(b.x_cm*scale)+'px';
    });
    if(tAcc>=duration){cancelAnimationFrame(animId);return;}
    animId=requestAnimationFrame(step);
  }
  animId=requestAnimationFrame(step);
}

function relayout(){layoutHeight(2);drawRuler();}
relayout();
window.addEventListener('resize',relayout);
document.getElementById('run').addEventListener('click',start);
</script>
</body>
</html>
